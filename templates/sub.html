{% extends "base.html" %}
{% block title %}Sub It{% endblock %}
{% block links %}
    <link rel="stylesheet" href="{{ url_for('static',filename='styles/sub.css') }}" />
{% endblock %}
{% block subActive %}class="active"{% endblock %}
{% block content %}
    {% if auth %}
        <div class="header">    
            <h1>Hi {{ user.fname }}!</h1>
            <a class='sub-it' href='/sub'>Sub It!</a>
        </div>
        <hr />
        <div class='container'>
            <h3>Sub It</h3>
            {% if recipe %}
                <div class='subResults-container container'>
                    <div class='center'> 
                        <h3>{{ recipe.name.capitalize().replace("_", " ") }}</h3>
                        <img id='uploadedPic' width='400px' src="{{ url_for('static',filename='img/' + recipe.image) }}"/>
                    </div>
                    <h4>Ingredients</h4>
                    <br/>
                    <p>{{ ', '.join(recipe.ingredients) }}</p>
                    <br/>
                    <h4>Alternative Ingredients</h4>
                    {% for alt in alts %}
                        <p>Instead of {{alt.food}}, use {{alt.alternative.replace('_', ' ')}} to save {{alt.savings}} kg CO<sub>2</sub></p>
                    {% endfor %}
                </div>
            {% else %}
                <div class='subForm-container container'>
                    <form action="{{ url_for('sub') }}" enctype="multipart/form-data" method='post' id='subitForm'>
                        <i class='far fa-image'></i>
                        <p>Upload an image of your favourite foods to find out which ingredients you can use to reduce your carbon footprint.</p>
                        <label for='foodImg' id='foodImgLabel'>Upload an Image</label>
                        <input type='file' id='foodImg' name='foodImg' accept='image/png, image/jpg, image/jpeg' />
                        <div id='previewUpload'></div>
                        <input type='submit' id='uploadImg' name='uploadImg' value='Scan' />
                    </form>
                </div>
            {% endif %}
        </div>
    {% else %}
        <div class="header">    
            <h1>Welcome!</h1>
            <a class='sub-it' href='/sub'>Sub It!</a>
        </div>
        <hr/>
        <div class="container">
            <h3>Sub It</h3>
            <p class="signin-prompt"><a href="{{ url_for('signin')}}">Sign in</a> to get started.</p>
        </div>
    {% endif %}
{% endblock %}
{% block scripts %}
    <script type="text/javascript" src="https://unpkg.com/webcam-easy/dist/webcam-easy.min.js"></script>
    <script>
        var imgUrl = '';
        $('#foodImg').on('change', function(e) {
            if (e.target.files[0]) {
                imgUrl = URL.createObjectURL(e.target.files[0]);
                $('#previewUpload').html(`<img src="` + imgUrl + `" width="400px" />`);
            }
        });


    </script>
{% endblock %}